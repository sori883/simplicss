{"version":3,"file":"alert.js","sources":["../src/alert.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap (v4.3.1): alert.js\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport $ from 'jquery'\nimport Util from './util'\n\nconst NAME = 'alert'\nconst VERSION = '0.5.2'\n\nconst DATA_KEY = 'sc.alert'\n// アラート閉じた時のイベントとかに使うみたい\n// http://bootstrap3.cyberlab.info/javascript/alerts-events.html\nconst EVENT_KEY = `.${DATA_KEY}`\n// イベントを無効にする用\n// https://getbootstrap.jp/docs/4.1/getting-started/javascript/\nconst DATA_API_KEY = '.data-api'\n// 他のフレームワークと名前衝突を回避する用\nconst JQUERY_NO_CONFLICT = $.fn[NAME]\n\n// アラート消す用\nconst Selector = {\n  DISMISS : '[data-dismiss=\"alert\"]'\n}\n\n// イベント用の名前\n// e.g. close.sc.alert\nconst Event = {\n  CLOSE : `close${EVENT_KEY}`,\n  CLOSED : `closed${EVENT_KEY}`,\n  CLICK_DATA_API : `click${EVENT_KEY}${DATA_API_KEY}`\n}\n\n// htmlのクラス名\nconst ClassName = {\n  ALERT : 'alert',\n  FADE  : 'fade',\n  SHOW  : 'show'\n}\n\nclass Alert {\n  constructor(element) {\n    this._element = element\n  }\n\n  // バージョンのゲッター\n  static get VERSION() {\n    return VERSION\n  }\n\n  // public method\n\n  close(element) {\n    // このクラス内のthisはalertクラス\n\n    // コンストラクタで取得したelement\n    let rootElement = this._element\n\n    // closeにelementが引数で渡されていたら\n    if (element) {\n      // div.alertを取得\n      rootElement = this._getRootElement(element)\n    }\n\n    // カスタムイベントを作成\n    const customEvent = this._triggerCloseEvent(rootElement)\n\n    // イベントがブラウザの処理を禁止していた場合は闇に葬り去る\n    // http://www.jquerystudy.info/reference/events/isDefaultPrevented.html\n    if (customEvent.isDefaultPrevented()) {\n      return\n    }\n\n    // showクラスを削除する\n    // fadeクラスがなかった場合、要素を削除する\n    this._removeElement(rootElement)\n  }\n\n  // this._elementを削除するみたい\n  dispose() {\n    $.removeData(this._element, DATA_KEY)\n    this._element = null\n  }\n\n  // private method\n\n  // closeで使ってるやつ\n  _getRootElement(element) {\n    // elementのdata-targetもしくはhrefで指定されているselectorを取得\n    const selector = Util.getSelectorFromElement(element)\n    let parent     = false\n\n    // selectorがあった場合\n    if (selector) {\n      // data-targetもしくはhrefで指定されている要素を取得\n      // 開始タグから終了タグまで持ってくるみたい\n      parent = document.querySelector(selector)\n    }\n\n    // 上のifを通らなかったか通ってもnullが帰ってきた場合\n    if (!parent) {\n      // data-targetもしくはhrefが指定されてないので、一番近い.alertを取得する\n      parent = $(element).closest(`.${ClassName.ALERT}`)[0]\n    }\n\n    return parent\n  }\n\n  // closeで使ってるやつ\n  _triggerCloseEvent(element) {\n    // close.sc.alertイベントを定義\n    const closeEvent = $.Event(Event.CLOSE)\n\n    $(element).trigger(closeEvent) // closeイベントを発生\n    // closeEvent返すんか\n    return closeEvent\n  }\n\n  // closeで使ってるやつ\n  _removeElement(element) {\n    // showクラスを削除\n    $(element).removeClass(ClassName.SHOW)\n\n    // fadeクラスを持ってなかった場合\n    if (!$(element).hasClass(ClassName.FADE)) {\n      // アラートを削除\n      this._destroyElement(element)\n      return // eslint-disable-line no-useless-return\n    }\n\n    // 要素の変化にかかる時間を取得\n    const transitionDuration = Util.getTransitionDurationFromElement(element)\n\n    $(element)\n      // .oneは一回だけ実行するイベント。TRANSITION_ENDはイベント名。\n      // エレメントを削除してclosedイベントを実行する\n      .one(Util.TRANSITION_END, (event) => this._destroyElement(element, event))\n      // util.jsのtransitionEndEmulatorを実行\n      .emulateTransitionEnd(transitionDuration)\n  }\n\n  // _removeElementで使ってるやつ\n  _destroyElement(element) {\n    $(element) // elementを。。。\n      .detach() // elementを隔離\n      .trigger(Event.CLOSED) // closedイベントを発生させる\n      .remove() // element削除\n      // https://qiita.com/BRSF/items/1aa9d154bde497b0baa0#remove%E3%81%AE%E5%A0%B4%E5%90%88\n  }\n\n  // static\n\n  static _jQueryInterface(config) {\n    return this.each(function () {\n      // elementを格納\n      const $element = $(this)\n      // elementのdata-sc.alert属性を取得\n      let data = $element.data(DATA_KEY)\n\n      // dataがなかったら\n      if (!data) {\n        // アラートをインスタンス化\n        // thisはelement\n        data = new Alert(this)\n        // elementにdata-sc.alertを設定\n        // 中身はdata\n        $element.data(DATA_KEY, data)\n      }\n\n      // configがcloseだったら・・・・\n      if (config === 'close') {\n        // alert.close(element)になる\n        data[config](this)\n      }\n    })\n  }\n\n  static _handleDismiss(alertInstance) {\n    return function (event) {\n      // イベントがあったら\n      if (event) {\n        // イベントの動作を停止させる\n        event.preventDefault()\n      }\n\n      // 引数で受け取ったalertインスタンスのcloseを実行\n      // 引数はhtmlのbutton\n      alertInstance.close(this)\n    }\n  }\n}\n\n/**\n * ------------------------------------------------------------------------\n * Data Apiの定義\n * ------------------------------------------------------------------------\n */\n\n// ここがブラウザで使う部分みたい\n$(document).on(\n  Event.CLICK_DATA_API, // click.sc.alert.data-api\n  Selector.DISMISS, // [data-dismiss=\"alert\"]\n  Alert._handleDismiss(new Alert()) // staticのやつ実行するんだね\n)\n\n/**\n * ------------------------------------------------------------------------\n * jQuery\n * ------------------------------------------------------------------------\n */\n\n// .alertは_jQueryInterface\n$.fn[NAME] = Alert._jQueryInterface\n// .alert.ConstructorはAlert\n$.fn[NAME].Constructor = Alert\n\n// .alert.noConflict\n// 衝突回避用\n$.fn[NAME].noConflict  = () => {\n  $.fn[NAME] = JQUERY_NO_CONFLICT\n  return Alert._jQueryInterface\n}\n\n\nexport default Alert\n"],"names":["NAME","VERSION","DATA_KEY","EVENT_KEY","DATA_API_KEY","JQUERY_NO_CONFLICT","$","fn","Selector","DISMISS","Event","CLOSE","CLOSED","CLICK_DATA_API","ClassName","ALERT","FADE","SHOW","Alert","element","_element","close","rootElement","_getRootElement","customEvent","_triggerCloseEvent","isDefaultPrevented","_removeElement","dispose","removeData","selector","Util","getSelectorFromElement","parent","document","querySelector","closest","closeEvent","trigger","removeClass","hasClass","_destroyElement","transitionDuration","getTransitionDurationFromElement","one","TRANSITION_END","event","emulateTransitionEnd","detach","remove","_jQueryInterface","config","each","$element","data","_handleDismiss","alertInstance","preventDefault","on","Constructor","noConflict"],"mappings":"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"}