{"version":3,"file":"dropdown.js","sources":["../src/dropdown.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap (v4.4.1): dropdown.js\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport $ from 'jquery'\nimport Popper from 'popper.js'\nimport Util from './util'\n\n/**\n * ------------------------------------------------------------------------\n * Constants\n * ------------------------------------------------------------------------\n */\n\nconst NAME = 'dropdown'\nconst VERSION = '0.5.2'\nconst DATA_KEY = 'sc.dropdown'\nconst EVENT_KEY = `.${DATA_KEY}`\nconst DATA_API_KEY = '.data-api'\nconst JQUERY_NO_CONFLICT = $.fn[NAME]\nconst ESCAPE_KEYCODE = 27 // Escキー\nconst SPACE_KEYCODE = 32 // スペースキー\nconst TAB_KEYCODE = 9 // タブキー\nconst ARROW_UP_KEYCODE = 38 // ↑キー\nconst ARROW_DOWN_KEYCODE = 40 // ↓キー\nconst RIGHT_MOUSE_BUTTON_WHICH = 3 // マウスの右クリック\n// 正規表現オブジェクト作成\nconst REGEXP_KEYDOWN = new RegExp(`${ARROW_UP_KEYCODE}|${ARROW_DOWN_KEYCODE}|${ESCAPE_KEYCODE}`)\n\nconst Event = {\n  HIDE : `hide${EVENT_KEY}`,\n  HIDDEN : `hidden${EVENT_KEY}`,\n  SHOW : `show${EVENT_KEY}`,\n  SHOWN: `shown${EVENT_KEY}`,\n  CLICK : `click${EVENT_KEY}`,\n  CLICK_DATA_API : `click${EVENT_KEY}${DATA_API_KEY}`,\n  KEYDOWN_DATA_API : `keydown${EVENT_KEY}${DATA_API_KEY}`,\n  KEYUP_DATA_API : `keyup${EVENT_KEY}${DATA_API_KEY}`\n}\n\nconst ClassName = {\n  DISABLED : 'disabled',\n  SHOW : 'show',\n  DROPUP : 'dropup',\n  DROPRIGHT : 'dropright',\n  DROPLEFT : 'dropleft',\n  MENURIGHT : 'dropdown-menu-right',\n  MENULEFT : 'dropdown-menu-left',\n  POSITION_STATIC : 'position-static'\n}\n\nconst Selector = {\n  DATA_TOGGLE : '[data-toggle=\"dropdown\"]',\n  FORM_CHILD : '.dropdown form',\n  MENU : '.dropdown-menu',\n  NAVBAR_NAV : '.navbar-nav',\n  VISIBLE_ITEMS : '.dropdown-menu .dropdown-item:not(.disabled):not(:disabled)'\n}\n\nconst AttachmentMap = {\n  TOP : 'top-start',\n  TOPEND : 'top-end',\n  BOTTOM : 'bottom-start',\n  BOTTOMEND : 'bottom-end',\n  RIGHT : 'right-start',\n  RIGHTEND : 'right-end',\n  LEFT : 'left-start',\n  LEFTEND : 'left-end'\n}\n\nconst Default = {\n  offset : 0,\n  flip : true,\n  boundary : 'scrollParent',\n  reference : 'toggle',\n  display : 'dynamic',\n  popperConfig : null\n}\n\nconst DefaultType = {\n  offset : '(number|string|function)',\n  flip : 'boolean',\n  boundary : '(string|element)',\n  reference : '(string|element)',\n  display : 'string',\n  popperConfig : '(null|object)'\n}\n\n/**\n * ------------------------------------------------------------------------\n * Class\n * ------------------------------------------------------------------------\n */\n\nclass Dropdown {\n  // エレメントとtoggle\n  constructor(element, config) {\n    this._element = element\n    this._popper = null\n    // configを取得\n    this._config = this._getConfig(config)\n    // .dropdown-menuを取得\n    this._menu = this._getMenuElement()\n    // dropdownがnavbarに存在しているか確認\n    this._inNavbar = this._detectNavbar()\n    // クリックイベントの設定\n    this._addEventListeners()\n  }\n\n    // Getters\n\n    static get VERSION() {\n      return VERSION\n    }\n  \n    static get Default() {\n      return Default\n    }\n  \n    static get DefaultType() {\n      return DefaultType\n    }\n\n    toggle() {\n      // エレメントがdisable属性もしくはclassを持ってたら処理終了\n      if (this._element.disabled || $(this._element).hasClass(ClassName.DISABLED)) {\n        return\n      }\n  \n      // メニューが.showを持ってるか判定\n      const isActive = $(this._menu).hasClass(ClassName.SHOW)\n  \n      Dropdown._clearMenus()\n  \n      // .showを持ってたら処理終了\n      if (isActive) {\n        return\n      }\n  \n      // 下のshowを発動\n      this.show(true)\n    }\n\n    show(usePopper = false) {\n      // dropdownもしくはメニューがdisableになってたら処理終了\n      if (this._element.disabled || $(this._element).hasClass(ClassName.DISABLED) || $(this._menu).hasClass(ClassName.SHOW)) {\n        return\n      }\n\n      // showを指定するターゲットを指定\n      const relatedTarget = {\n        relatedTarget: this._element\n      }\n\n      // show.sc.dropdownイベントを定義して、ターゲットを渡す\n      const showEvent = $.Event(Event.SHOW, relatedTarget)\n\n      const parent = Dropdown._getParentFromElement(this._element)\n\n      // parentに対してshoweventを発動する\n      $(parent).trigger(showEvent)\n\n      // ブラウザの処理を禁止してたら処理終了\n      if (showEvent.isDefaultPrevented()) {\n        return\n      }\n\n    // NavbarでドロップダウンのPopper.jsを完全に無効にする\n    if (!this._inNavbar && usePopper) {\n      /**\n       * Check for Popper dependency\n       * Popper - https://popper.js.org\n       */\n      // popperが読み込まれているか確認\n      if (typeof Popper === 'undefined') {\n        throw new TypeError('Simplicss\\'s dropdowns require Popper.js (https://popper.js.org/)')\n      }\n\n      // エレメントを格納\n      let referenceElement = this._element\n\n      if (this._config.reference === 'parent') {\n        referenceElement = parent\n      } else if (Util.isElement(this._config.reference)) {\n        referenceElement = this._config.reference\n\n        // Check if it's jQuery element\n        if (typeof this._config.reference.jquery !== 'undefined') {\n          referenceElement = this._config.reference[0]\n        }\n      }\n\n      // If boundary is not `scrollParent`, then set position to `static`\n      // to allow the menu to \"escape\" the scroll parent's boundaries\n      // https://github.com/twbs/bootstrap/issues/24251\n      if (this._config.boundary !== 'scrollParent') {\n        $(parent).addClass(ClassName.POSITION_STATIC)\n      }\n      this._popper = new Popper(referenceElement, this._menu, this._getPopperConfig())\n    }\n\n        // If this is a touch-enabled device we add extra\n    // empty mouseover listeners to the body's immediate children;\n    // only needed because of broken event delegation on iOS\n    // https://www.quirksmode.org/blog/archives/2014/02/mouse_event_bub.html\n    if ('ontouchstart' in document.documentElement &&\n        $(parent).closest(Selector.NAVBAR_NAV).length === 0) {\n      $(document.body).children().on('mouseover', null, $.noop)\n    }\n\n    this._element.focus()\n    this._element.setAttribute('aria-expanded', true)\n\n    $(this._menu).toggleClass(ClassName.SHOW)\n    $(parent)\n      .toggleClass(ClassName.SHOW)\n      .trigger($.Event(Event.SHOWN, relatedTarget))\n  }\n\n   // Private\n\n   _addEventListeners() {\n     // this_elementをクリックした時のイベントを定義する\n    $(this._element).on(Event.CLICK, (event) => {\n      // this._elementイベント禁止\n      event.preventDefault()\n      // 親要素のイベントが実行されないようにeventの伝播を禁止する\n      event.stopPropagation()\n      // 要素の表示を切り替える\n      this.toggle()\n    })\n  }\n\n  // configを取得\n  _getConfig(config) {\n    config = {\n      // default\n      ...this.constructor.Default,\n      // 要素に格納してあるデータとキーを取得する\n      ...$(this._element).data(),\n      // toggle\n      ...config\n    }\n\n    Util.typeCheckConfig(\n      // dropdown\n      NAME,\n      // toggle\n      config,\n      // default type\n      this.constructor.DefaultType\n    )\n\n    return config\n  }\n\n  _getMenuElement() {\n    // this._menuが存在しなかった場合\n    if (!this._menu) {\n      // this._elementの親要素を返す\n      const parent = Dropdown._getParentFromElement(this._element)\n\n      // parentが存在していた場合\n      if (parent) {\n        // .dropdown-menuをthis._menuに格納する\n        this._menu = parent.querySelector(Selector.MENU)\n      }\n    }\n    // this._menuが存在してたらそのまま返す。\n    // 存在してなかったら、取得して返す\n    return this._menu\n  }\n\n  _getPlacement() {\n    const $parentDropdown = $(this._element.parentNode)\n    let placement = AttachmentMap.BOTTOM\n\n    // Handle dropup\n    if ($parentDropdown.hasClass(ClassName.DROPUP)) {\n      placement = AttachmentMap.TOP\n      if ($(this._menu).hasClass(ClassName.MENURIGHT)) {\n        placement = AttachmentMap.TOPEND\n      }\n    } else if ($parentDropdown.hasClass(ClassName.DROPRIGHT)) {\n      placement = AttachmentMap.RIGHT\n    } else if ($parentDropdown.hasClass(ClassName.DROPLEFT)) {\n      placement = AttachmentMap.LEFT\n    } else if ($(this._menu).hasClass(ClassName.MENURIGHT)) {\n      placement = AttachmentMap.BOTTOMEND\n    }\n    return placement\n  }\n\n  _detectNavbar() {\n    // .navbar要素にdropdownが存在していないか確認\n    return $(this._element).closest('.navbar').length > 0\n  }\n\n  _getOffset() {\n    const offset = {}\n\n    if (typeof this._config.offset === 'function') {\n      offset.fn = (data) => {\n        data.offsets = {\n          ...data.offsets,\n          ...this._config.offset(data.offsets, this._element) || {}\n        }\n\n        return data\n      }\n    } else {\n      offset.offset = this._config.offset\n    }\n\n    return offset\n  }\n\n  _getPopperConfig() {\n    const popperConfig = {\n      placement: this._getPlacement(),\n      modifiers: {\n        offset: this._getOffset(),\n        flip: {\n          enabled: this._config.flip\n        },\n        preventOverflow: {\n          boundariesElement: this._config.boundary\n        }\n      }\n    }\n\n    // Disable Popper.js if we have a static display\n    if (this._config.display === 'static') {\n      popperConfig.modifiers.applyStyle = {\n        enabled: false\n      }\n    }\n\n    return {\n      ...popperConfig,\n      ...this._config.popperConfig\n    }\n  }\n\n  // Static\n\n  static _jQueryInterface(config) {\n    return this.each(function () {\n      let data = $(this).data(DATA_KEY)\n      const _config = typeof config === 'object' ? config : null\n\n      if (!data) {\n        data = new Dropdown(this, _config)\n        $(this).data(DATA_KEY, data)\n      }\n\n      if (typeof config === 'string') {\n        if (typeof data[config] === 'undefined') {\n          throw new TypeError(`No method named \"${config}\"`)\n        }\n        data[config]()\n      }\n    })\n  }\n\n  static _clearMenus(event) {\n    // イベントが存在していてかつ、イベントがマウスの右クリックまたはキーを離した、またはタブキーじゃないものを押下した場合\n    if (event && (event.which === RIGHT_MOUSE_BUTTON_WHICH ||\n      event.type === 'keyup' && event.which !== TAB_KEYCODE)) {\n      // 処理を終了する\n      return\n    }\n\n    //  '[data-toggle=\"dropdown\"]'をもつ .要素を全て取得する\n    const toggles = [].slice.call(document.querySelectorAll(Selector.DATA_TOGGLE))\n\n    // 取得したtogglesの数だけループ回す\n    for (let i = 0, len = toggles.length; i < len; i++) {\n      // togglesの親ノードを取得する\n      const parent = Dropdown._getParentFromElement(toggles[i])\n      // toggle要素のsc.dropdownを取得する\n      const context = $(toggles[i]).data(DATA_KEY)\n      // 連想配列にtoggleを追加\n      const relatedTarget = {\n        relatedTarget: toggles[i]\n      }\n\n      // イベントが存在してイベントがclickだったら\n      if (event && event.type === 'click') {\n        // relatedTargetのclickイベントにイベントを追加\n        relatedTarget.clickEvent = event\n      }\n\n      // sc.dropdownが存在していたら\n      if (!context) {\n        // 処理を継続する\n        continue\n      }\n\n      // contextのmenuをdropdownmenuに代入\n      const dropdownMenu = context._menu\n      // parentがshowクラスを持ってたら\n      if (!$(parent).hasClass(ClassName.SHOW)) {\n        // 処理を継続\n        continue\n      }\n\n      if (event && (event.type === 'click' &&\n          /input|textarea/i.test(event.target.tagName) || event.type === 'keyup' && event.which === TAB_KEYCODE) &&\n          $.contains(parent, event.target)) {\n        continue\n      }\n\n      const hideEvent = $.Event(Event.HIDE, relatedTarget)\n      $(parent).trigger(hideEvent)\n      if (hideEvent.isDefaultPrevented()) {\n        continue\n      }\n\n      // If this is a touch-enabled device we remove the extra\n      // empty mouseover listeners we added for iOS support\n      if ('ontouchstart' in document.documentElement) {\n        $(document.body).children().off('mouseover', null, $.noop)\n      }\n\n      toggles[i].setAttribute('aria-expanded', 'false')\n\n      if (context._popper) {\n        context._popper.destroy()\n      }\n\n      $(dropdownMenu).removeClass(ClassName.SHOW)\n      $(parent)\n        .removeClass(ClassName.SHOW)\n        .trigger($.Event(Event.HIDDEN, relatedTarget))\n    }\n  }\n\n  static _getParentFromElement(element) {\n    let parent\n    // data-targetかtrimされたhrefのどっちかを返す\n    const selector = Util.getSelectorFromElement(element)\n\n    // selectorが存在した場合\n    if (selector) {\n      // documentからselectorの要素を取得する\n      parent = document.querySelector(selector)\n    }\n    \n    // parentが存在していたらparentを返す\n    // そうでなければ、elementのparentNodeで返す\n    // parentNodeは親ノード\n    return parent || element.parentNode\n  }\n\n  // eslint-disable-next-line complexity\n  static _dataApiKeydownHandler(event) {\n    // If not input/textarea:\n    //  - And not a key in REGEXP_KEYDOWN => not a dropdown command\n    // If input/textarea:\n    //  - If space key => not a dropdown command\n    //  - If key is other than escape\n    //    - If key is not up or down => not a dropdown command\n    //    - If trigger inside the menu => not a dropdown command\n    if (/input|textarea/i.test(event.target.tagName)\n      ? event.which === SPACE_KEYCODE || event.which !== ESCAPE_KEYCODE &&\n      (event.which !== ARROW_DOWN_KEYCODE && event.which !== ARROW_UP_KEYCODE ||\n        $(event.target).closest(Selector.MENU).length) : !REGEXP_KEYDOWN.test(event.which)) {\n      return\n    }\n\n    event.preventDefault()\n    event.stopPropagation()\n\n    if (this.disabled || $(this).hasClass(ClassName.DISABLED)) {\n      return\n    }\n\n    const parent   = Dropdown._getParentFromElement(this)\n    const isActive = $(parent).hasClass(ClassName.SHOW)\n\n    if (!isActive && event.which === ESCAPE_KEYCODE) {\n      return\n    }\n\n    if (!isActive || isActive && (event.which === ESCAPE_KEYCODE || event.which === SPACE_KEYCODE)) {\n      if (event.which === ESCAPE_KEYCODE) {\n        const toggle = parent.querySelector(Selector.DATA_TOGGLE)\n        $(toggle).trigger('focus')\n      }\n\n      $(this).trigger('click')\n      return\n    }\n\n    const items = [].slice.call(parent.querySelectorAll(Selector.VISIBLE_ITEMS))\n      .filter((item) => $(item).is(':visible'))\n\n    if (items.length === 0) {\n      return\n    }\n\n    let index = items.indexOf(event.target)\n\n    if (event.which === ARROW_UP_KEYCODE && index > 0) { // Up\n      index--\n    }\n\n    if (event.which === ARROW_DOWN_KEYCODE && index < items.length - 1) { // Down\n      index++\n    }\n\n    if (index < 0) {\n      index = 0\n    }\n\n    items[index].focus()\n  }\n}\n"],"names":["NAME","JQUERY_NO_CONFLICT","$","fn"],"mappings":";;;;;;;;;;EAWA;;;;;;EAMA,IAAMA,IAAI,GAAG,UAAb;AACA,EAIA,IAAMC,kBAAkB,GAAGC,CAAC,CAACC,EAAF,CAAKH,IAAL,CAA3B;;;;"}